{% extends "wagtailadmin/generic/form.html" %}
{% load i18n wagtailadmin_tags static %}

{% block titletag %}{% trans "Add a document" %}{% endblock %}

{% block extra_js %}
    {{ block.super }}
{% endblock %}

{% block form %}
    <form action="{% url 'wagtaildocs:add' %}" method="POST" enctype="multipart/form-data"
          data-controller="w-form">
        {% csrf_token %}
        
        {# File Input with Sync Controller #}
        <div class="field">
            <label for="id_file">{% trans "Document file" %}</label>
            <input
                type="file"
                name="file"
                id="id_file"
                required
                accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf"
                data-action="change->w-sync#apply drop->w-sync#apply"
                data-w-sync-target-value="#id_title"
                data-w-sync-normalize-value="true"
                data-w-sync-event-name-value="wagtail:documents-upload"
                aria-describedby="file-help"
            >
            <p id="file-help" class="help">
                {% trans "Supported formats: PDF, Word, Excel, PowerPoint, Text" %}
            </p>
        </div>
        
        {# Title Input with Clean Controller #}
        <div class="field">
            <label for="id_title">{% trans "Title" %}</label>
            <input
                type="text"
                name="title"
                id="id_title"
                required
                data-action="blur->w-clean#slugify input->w-clean#updatePreview"
                data-w-clean-regex-value="[^a-zA-Z0-9-]"
                data-w-clean-replacement-value=""
                data-w-clean-preview-target-value="#filename-preview"
            >
            <p id="filename-preview" class="help"></p>
        </div>
        
        {# Submit Button #}
        <div class="actions">
            <button
                type="submit"
                class="button button-longrunning"
                data-controller="w-progress"
                data-action="w-progress#activate"
                data-w-progress-active-value="{% trans 'Uploadingâ€¦' %}"
            >
                {% icon name="spinner" %}
                <em data-w-progress-target="label">{% trans 'Upload' %}</em>
            </button>
        </div>
    </form>
{% endblock %}
