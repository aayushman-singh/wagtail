{% extends "wagtailadmin/generic/form.html" %}
{% load i18n wagtailadmin_tags %}
{% block titletag %}{% trans "Add a document" %}{% endblock %}

{% block extra_js %}
    {{ block.super }}

    <script type="module">
        import { CleanController } from "../../../../../client/src/controllers/CleanController";
        import { SyncController } from "../../../../../client/src/controllers/SyncController";

        const application = Stimulus.Application.start();
        application.register('w-clean', CleanController);
        application.register('w-sync', SyncController);
    </script>
{% endblock %}

{% block form %}
    <form action="{% url 'wagtaildocs:add' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div>
            <input
                type="file"
                name="file"
                id="id_file"
                data-controller="w-sync"
                data-action="change->w-sync#apply"
                data-w-sync-target-value="#id_title"            
                data-w-sync-normalize-value="true"              
                data-w-sync-event-name-value="wagtail:documents-upload"      
            >
        </div>
        <div>
            <input
                type="text"
                name="title"
                id="id_title"
                data-controller="w-clean"
                data-action="blur->w-clean#slugify"              
                data-w-clean-regex-value="[^a-zA-Z0-9-]"         
                data-w-clean-replacement-value=""                 
            >
        </div>
        <div>
            {% trans "Upload" as upload_label %}
            <button
                type="submit"
                class="button button-longrunning"
                data-controller="w-progress"
                data-action="w-progress#activate"
                data-w-progress-active-value="{% trans 'Uploadingâ€¦' %}"
            >
                {% icon name="spinner" %}
                <em data-w-progress-target="label">{{ upload_label }}</em>
            </button>
        </div>
    </form>
{% endblock %}
